<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Monkey Tower Defense</title>

<style>
body {
  margin: 0;
  background: #0d120b;
  color: white;
  font-family: Arial;
  text-align: center;
}

#ui {
  background: #1b2415;
  padding: 10px;
}

button {
  background: #3a4a2b;
  color: white;
  border: 1px solid #6b8e23;
  padding: 8px;
  margin: 3px;
  cursor: pointer;
}

button:hover {
  background: #556b2f;
}

#upgradePanel {
  margin-top: 8px;
  display: none;
}

canvas {
  display: block;
  margin: auto;
  background: #2b3a1f;
  border: 2px solid #556b2f;
}
</style>
</head>

<body>

<div id="ui">
  ‚ù§Ô∏è <span id="lives">20</span>
  üçå <span id="bananas">150</span>
  üåä Wave <span id="wave">0</span><br>

  <button onclick="startWave()">Start Wave</button>
  <button onclick="placingTower=true">Place Monkey (üçå50)</button>

  <div id="upgradePanel">
    <h4>Upgrade Monkey</h4>
    <button onclick="upgrade('damage')">Stronger Throws (üçå30)</button>
    <button onclick="upgrade('range')">Better Aim (üçå30)</button>
    <button onclick="upgrade('fireRate')">Faster Throws (üçå30)</button>
  </div>
</div>

<canvas id="game" width="800" height="500"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let lives = 20;
let bananas = 150;
let wave = 0;
let placingTower = false;
let selectedTower = null;

const path = [
  {x:0,y:250},{x:200,y:250},{x:200,y:100},
  {x:500,y:100},{x:500,y:400},{x:800,y:400}
];

const enemies=[], towers=[], bullets=[];

// ---------- ENEMY (GORILLA) ----------
class Enemy {
  constructor() {
    this.x = path[0].x;
    this.y = path[0].y;
    this.hp = 60 + wave * 15;
    this.maxHp = this.hp;
    this.speed = 1.1 + wave * 0.03;
    this.index = 0;
  }

  update() {
    const t = path[this.index+1];
    if (!t) {
      lives--;
      return false;
    }
    const dx=t.x-this.x, dy=t.y-this.y;
    const d=Math.hypot(dx,dy);
    if (d < this.speed) this.index++;
    else {
      this.x+=dx/d*this.speed;
      this.y+=dy/d*this.speed;
    }
    return true;
  }

  draw() {
    // body
    ctx.fillStyle="#3a3a3a";
    ctx.beginPath();
    ctx.arc(this.x,this.y,14,0,Math.PI*2);
    ctx.fill();

    // eyes
    ctx.fillStyle="red";
    ctx.beginPath();
    ctx.arc(this.x-4,this.y-3,2,0,Math.PI*2);
    ctx.arc(this.x+4,this.y-3,2,0,Math.PI*2);
    ctx.fill();

    // HP bar
    ctx.fillStyle="lime";
    ctx.fillRect(this.x-16,this.y-22,(this.hp/this.maxHp)*32,4);
  }
}

// ---------- TOWER (MONKEY) ----------
class Tower {
  constructor(x,y){
    this.x=x; this.y=y;
    this.range=160;
    this.fireRate=30;
    this.cooldown=0;
    this.damage=25;
    this.recoil=0;
  }

  update(){
    if(this.cooldown>0){this.cooldown--;return;}
    const target=enemies.find(e=>Math.hypot(e.x-this.x,e.y-this.y)<=this.range);
    if(target){
      bullets.push(new Bullet(this,target));
      this.cooldown=this.fireRate;
      this.recoil=4;
    }
  }

  draw(){
    if(this.recoil>0) this.recoil--;

    // ears
    ctx.fillStyle="#8b5a2b";
    ctx.beginPath();
    ctx.arc(this.x-14,this.y,6,0,Math.PI*2);
    ctx.arc(this.x+14,this.y,6,0,Math.PI*2);
    ctx.fill();

    // head
    ctx.fillStyle=this===selectedTower?"#ffd700":"#a0522d";
    ctx.beginPath();
    ctx.arc(this.x,this.y,15-this.recoil,0,Math.PI*2);
    ctx.fill();

    // eyes
    ctx.fillStyle="black";
    ctx.beginPath();
    ctx.arc(this.x-4,this.y-3,2,0,Math.PI*2);
    ctx.arc(this.x+4,this.y-3,2,0,Math.PI*2);
    ctx.fill();

    if(this===selectedTower){
      ctx.strokeStyle="rgba(255,255,255,0.25)";
      ctx.beginPath();
      ctx.arc(this.x,this.y,this.range,0,Math.PI*2);
      ctx.stroke();
    }
  }
}

// ---------- BANANA BULLET ----------
class Bullet{
  constructor(t,e){
    this.x=t.x; this.y=t.y;
    this.e=e;
    this.speed=6;
    this.dmg=t.damage;
  }

  update(){
    const dx=this.e.x-this.x, dy=this.e.y-this.y;
    const d=Math.hypot(dx,dy);
    if(d<6){
      this.e.hp-=this.dmg;
      return false;
    }
    this.x+=dx/d*this.speed;
    this.y+=dy/d*this.speed;
    return true;
  }

  draw(){
    ctx.fillStyle="yellow";
    ctx.beginPath();
    ctx.ellipse(this.x,this.y,4,2,0,0,Math.PI*2);
    ctx.fill();
  }
}

// ---------- GAME ----------
function startWave(){
  wave++;
  for(let i=0;i<8+wave*2;i++){
    setTimeout(()=>enemies.push(new Enemy()),i*500);
  }
}

function upgrade(type){
  if(!selectedTower||bananas<30) return;
  bananas-=30;
  if(type==="damage") selectedTower.damage+=8;
  if(type==="range") selectedTower.range+=20;
  if(type==="fireRate") selectedTower.fireRate=Math.max(10,selectedTower.fireRate-4);
}

canvas.onclick=e=>{
  const r=canvas.getBoundingClientRect();
  const x=e.clientX-r.left, y=e.clientY-r.top;

  selectedTower=null;
  document.getElementById("upgradePanel").style.display="none";

  for(const t of towers){
    if(Math.hypot(t.x-x,t.y-y)<15){
      selectedTower=t;
      document.getElementById("upgradePanel").style.display="block";
      return;
    }
  }

  if(placingTower && bananas>=50){
    towers.push(new Tower(x,y));
    bananas-=50;
    placingTower=false;
  }
};

function drawPath(){
  ctx.strokeStyle="#6b8e23";
  ctx.lineWidth=30;
  ctx.beginPath();
  ctx.moveTo(path[0].x,path[0].y);
  path.forEach(p=>ctx.lineTo(p.x,p.y));
  ctx.stroke();
}

function loop(){
  ctx.clearRect(0,0,800,500);
  drawPath();

  towers.forEach(t=>{t.update();t.draw();});

  for(let i=enemies.length-1;i>=0;i--){
    if(!enemies[i].update()){enemies.splice(i,1);continue;}
    if(enemies[i].hp<=0){bananas+=15;enemies.splice(i,1);}
    else enemies[i].draw();
  }

  for(let i=bullets.length-1;i>=0;i--){
    if(!bullets[i].update()) bullets.splice(i,1);
    else bullets[i].draw();
  }

  document.getElementById("lives").textContent=lives;
  document.getElementById("bananas").textContent=bananas;
  document.getElementById("wave").textContent=wave;

  if(lives<=0){alert("Game Over");location.reload();}
  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
